<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœä¹¦ç¥å™¨ V2 - éƒ¨ç½²æ•™ç¨‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2 .icon {
            font-size: 1.2em;
        }

        .section h3 {
            color: #555;
            margin: 25px 0 15px;
            font-size: 1.2em;
            border-left: 3px solid #667eea;
            padding-left: 12px;
        }

        .section p {
            margin-bottom: 15px;
            color: #555;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .warning strong {
            color: #856404;
        }

        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .info strong {
            color: #0c5460;
        }

        .step {
            display: flex;
            gap: 20px;
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        code {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        pre code {
            background: none;
            padding: 0;
        }

        .command {
            background: #f0f0f0;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            font-family: monospace;
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            color: white;
            opacity: 0.9;
        }

        footer a {
            color: white;
            text-decoration: underline;
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š æœä¹¦ç¥å™¨ V2</h1>
            <p>å®Œæ•´éƒ¨ç½²æ•™ç¨‹ä¸é¡¹ç›®æ¶æ„è¯´æ˜</p>
            <div class="nav-links">
                <a href="index.html">ğŸ  é¡¹ç›®æ¶æ„</a>
                <a href="#quick-start">ğŸš€ å¿«é€Ÿå¼€å§‹</a>
                <a href="#deploy">ğŸ“– éƒ¨ç½²æ•™ç¨‹</a>
            </div>
        </header>

        <div id="quick-start" class="section">
            <h2><span class="icon">ğŸš€</span> å¿«é€Ÿå¼€å§‹</h2>

            <div class="warning">
                <strong>âš ï¸ ç³»ç»Ÿè¦æ±‚</strong><br>
                â€¢ Ubuntu 22.04 LTS / Debian 12<br>
                â€¢ Python 3.11+<br>
                â€¢ å†…å­˜: æœ€ä½ 2GB (æ¨è 4GB+)<br>
                â€¢ ç£ç›˜: æœ€ä½ 20GB å¯ç”¨ç©ºé—´
            </div>

            <h3>ä¸€é”®è‡ªåŠ¨éƒ¨ç½² (æ¨è)</h3>

            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>å…‹éš†é¡¹ç›®å¹¶è¿è¡Œéƒ¨ç½²è„šæœ¬</h4>
                    <pre><code># å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/book_bot_v2.git
cd book_bot_v2

# è¿è¡Œè‡ªåŠ¨éƒ¨ç½²è„šæœ¬ (éœ€è¦ root æƒé™)
sudo bash deploy.sh</code></pre>
                    <p>éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š</p>
                    <ul style="margin-left: 20px; color: #666;">
                        <li>å®‰è£… Python 3.11ã€PostgreSQLã€Redisã€Meilisearch</li>
                        <li>åˆ›å»ºé¡¹ç›®ç›®å½•å’Œè™šæ‹Ÿç¯å¢ƒ</li>
                        <li>å®‰è£…æ‰€æœ‰ Python ä¾èµ–</li>
                        <li>é…ç½® systemd æœåŠ¡</li>
                    </ul>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>é…ç½®ç¯å¢ƒå˜é‡</h4>
                    <pre><code># ç¼–è¾‘ç¯å¢ƒé…ç½®æ–‡ä»¶
sudo nano /opt/book_bot_v2/.env</code></pre>
                    <p>å¿…é¡»é…ç½®ä»¥ä¸‹å˜é‡ï¼š</p>
                    <pre><code>BOT_TOKEN=your_telegram_bot_token
BOT_USERNAME=your_bot_username
DB_PASSWORD=your_secure_db_password
MEILI_API_KEY=your_meili_master_key</code></pre>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>åˆå§‹åŒ–æ•°æ®åº“å¹¶å¯åŠ¨æœåŠ¡</h4>
                    <pre><code># æ•°æ®åº“è¿ç§»
cd /opt/book_bot_v2
./manage.sh migrate

# å¯åŠ¨æœåŠ¡
sudo systemctl start book_bot_v2
sudo systemctl start book_bot_v2-worker

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status book_bot_v2</code></pre>
                </div>
            </div>

            <div class="info">
                <strong>ğŸ’¡ æç¤º</strong><br>
                éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ <code>sudo journalctl -u book_bot_v2 -f</code> æŸ¥çœ‹å®æ—¶æ—¥å¿—ã€‚
            </div>
        </div>

        <div id="deploy" class="section">
            <h2><span class="icon">ğŸ“–</span> è¯¦ç»†éƒ¨ç½²æ•™ç¨‹</h2>

            <h3>æ–¹å¼ä¸€ï¼šè‡ªåŠ¨éƒ¨ç½² (æ¨è)</h3>
            <p>é€‚åˆå¿«é€Ÿéƒ¨ç½²ï¼Œè‡ªåŠ¨å®Œæˆæ‰€æœ‰é…ç½®ã€‚</p>
            <div class="command">
                sudo bash deploy.sh
            </div>

            <h3>æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²</h3>
            <p>é€‚åˆéœ€è¦ç²¾ç»†æ§åˆ¶çš„é«˜çº§ç”¨æˆ·ã€‚</p>

            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>å®‰è£…ç³»ç»Ÿä¾èµ–</h4>
                    <pre><code># æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Python 3.11
sudo apt install -y python3.11 python3.11-venv python3-pip

# å®‰è£… PostgreSQL
sudo apt install -y postgresql postgresql-contrib

# å®‰è£… Redis
sudo apt install -y redis-server

# å…¶ä»–ä¾èµ–
sudo apt install -y git build-essential libpq-dev</code></pre>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>å®‰è£… Meilisearch</h4>
                    <pre><code># ä¸‹è½½ Meilisearch
curl -L https://install.meilisearch.com | sh

# ç§»åŠ¨åˆ°ç³»ç»Ÿç›®å½•
sudo mv meilisearch /usr/local/bin/

# åˆ›å»º systemd æœåŠ¡
sudo tee /etc/systemd/system/meilisearch.service > /dev/null << EOF
[Unit]
Description=Meilisearch
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/meilisearch --master-key YOUR_MASTER_KEY
Restart=always

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl enable meilisearch
sudo systemctl start meilisearch</code></pre>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>é…ç½®æ•°æ®åº“</h4>
                    <pre><code># å¯åŠ¨ PostgreSQL
sudo systemctl start postgresql

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
sudo -u postgres psql << EOF
CREATE DATABASE bookbot_v2;
CREATE USER bookbot WITH PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE bookbot_v2 TO bookbot;
\q
EOF</code></pre>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>éƒ¨ç½²é¡¹ç›®</h4>
                    <pre><code># å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/book_bot_v2.git /opt/book_bot_v2
cd /opt/book_bot_v2

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install --upgrade pip
pip install -r requirements.txt

# åˆ›å»ºç¯å¢ƒæ–‡ä»¶
cp .env.example .env
nano .env  # ç¼–è¾‘é…ç½®</code></pre>
                </div>
            </div>

            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>è¿è¡Œè¿ç§»å¹¶å¯åŠ¨æœåŠ¡</h4>
                    <pre><code># æ•°æ®åº“è¿ç§»
alembic upgrade head

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# æµ‹è¯•è¿è¡Œ
python run_bot.py</code></pre>
                </div>
            </div>

            <div class="step">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h4>é…ç½® Systemd æœåŠ¡</h4>
                    <pre><code># åˆ›å»º Bot æœåŠ¡
sudo tee /etc/systemd/system/book_bot_v2.service > /dev/null << EOF
[Unit]
Description=æœä¹¦ç¥å™¨ V2 - Telegram Bot
After=network.target postgresql.service redis.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/book_bot_v2
Environment=PATH=/opt/book_bot_v2/venv/bin
ExecStart=/opt/book_bot_v2/venv/bin/python run_bot.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# åˆ›å»º Worker æœåŠ¡
sudo tee /etc/systemd/system/book_bot_v2-worker.service > /dev/null << EOF
[Unit]
Description=æœä¹¦ç¥å™¨ V2 - Background Worker
After=network.target postgresql.service redis.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/book_bot_v2
Environment=PATH=/opt/book_bot_v2/venv/bin
ExecStart=/opt/book_bot_v2/venv/bin/python -m app.worker
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable book_bot_v2 book_bot_v2-worker
sudo systemctl start book_bot_v2 book_bot_v2-worker

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status book_bot_v2</code></pre>
                </div>
            </div>

            <h3>å¸¸ç”¨å‘½ä»¤</h3>
            <pre><code># æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u book_bot_v2 -f

# é‡å¯æœåŠ¡
sudo systemctl restart book_bot_v2

# åœæ­¢æœåŠ¡
sudo systemctl stop book_bot_v2

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status book_bot_v2</code></pre>

            <div class="info">
                <strong>ğŸ’¡ æç¤º</strong><br>
                éƒ¨ç½²å®Œæˆåï¼Œåœ¨ Telegram ä¸­æœç´¢ä½ çš„ Bot ç”¨æˆ·åï¼Œå‘é€ <code>/start</code> å‘½ä»¤æµ‹è¯•æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚
            </div>
        </div>

        <footer>
            <p>æœä¹¦ç¥å™¨ V2 | å®Œæ•´éƒ¨ç½²æ•™ç¨‹</p>
            <p style="margin-top: 10px;">
                <a href="index.html">ğŸ  è¿”å›æ¶æ„é¦–é¡µ</a>
            </p>
            <p style="margin-top: 20px; font-size: 0.9em; opacity: 0.8;">
                Â© 2024 æœä¹¦ç¥å™¨ | åŸºäº MIT åè®®å¼€æº
            </p>
        </footer>
    </div>
</body>
</html>
